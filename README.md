# Оптимизация кодонов

Этот проект реализует скрипт для оптимизации кодонов с использованием меметического алгоритма. Код адаптирован для работы как через консоль, так и через Jupyter Notebook, включая поддержку Google Colab. Проект включает установку зависимостей, запуск оптимизации и тестирование.

## Описание проекта

Скрипт оптимизирует ДНК-последовательности для заданных аминокислотных последовательностей, используя следующие критерии:
- **Codon Usage (CAI)**: Оптимизация использования кодонов для заданного организма (по умолчанию *E. coli* K-12 MG1655).
- **GC Content**: Поддержание GC-содержания в заданном диапазоне.
- **Avoid Pattern**: Исключение нежелательных мотивов.
- **RBS Specification**: Оптимизация расположения Shine-Dalgarno последовательности.
- **RNA Folding**: Оптимизация стабильности мРНК (требуется ViennaRNA).
- **Codon Pair Bias (CPB)**: Оптимизация парного использования кодонов.

Оптимизация выполняется с помощью меметического алгоритма, который сочетает генетический алгоритм с локальным поиском.

## Улучшения в коде

### 1. Универсальность для разных бактерий
- Добавлена поддержка выбора организма через параметры `organism` и `organism_id`.
- Данные об использовании кодонов загружаются через Entrez API для указанного организма (по NCBI Taxonomy ID).
- Поддержка различных таблиц кодонов (например, стандартный код, код для Mycoplasma).
- **Добавлена поддержка локальных таблиц кодонов**: Можно предоставить файл с таблицей кодонов, чтобы избежать загрузки через Entrez.

### 2. Оптимизация скорости загрузки данных
- Уменьшено количество загружаемых генов через Entrez (`retmax=100`).
- Добавлена пакетная загрузка генов (по 50 за запрос).
- Используется параллельная обработка для подсчёта кодонов.

### 3. Результаты
Результаты оптимизации для *Bacillus subtilis* (последний запуск):

| Последовательность   | Длина (aa) | Приспособленность | Время (с) | GC Content | CAI    |
|----------------------|------------|-------------------|-----------|------------|--------|
| ShortPeptide         | 6          | 3.5210            | 5.12      | 0.500      | 0.8921 |

## Установка

### Требования
- Python 3.8+
- Системные зависимости: `viennarna` (для RNAfold)

### Установка через `pip`
1. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/PavelShestun/OpGene.git
   cd OpGene
   ```
2. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```
3. (Для Linux) Установите ViennaRNA:
   ```bash
   sudo apt-get install -y viennarna
   ```

### Установка через `conda`
1. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/PavelShestun/OpGene.git
   cd OpGene
   ```
2. Создайте и активируйте окружение:
   ```bash
   conda env create -f environment.yml
   conda activate codon_optimization
   ```

### Для Google Colab
1. Клонируйте репозиторий в Colab:
   ```bash
   !git clone https://github.com/PavelShestun/OpGene.git
   %cd OpGene
   ```
2. Установите зависимости:
   ```bash
   !apt-get install -y viennarna
   !pip install -r requirements.txt
   ```
3. Откройте `src/run_notebook.ipynb` и следуйте инструкциям.

## Использование

### Выбор организма
Скрипт позволяет оптимизировать кодонное использование для разных бактерий. Для этого нужно указать:
- Название организма (например, `Bacillus subtilis`).
- NCBI Taxonomy ID (например, `1423` для *Bacillus subtilis*).
- (Опционально) ID таблицы кодонов (по умолчанию 11 — стандартный генетический код).

Примеры организмов:
- *Escherichia coli* K-12: TaxID `83333`
- *Bacillus subtilis*: TaxID `1423`
- *Streptomyces coelicolor*: TaxID `1902`

### Использование локальной таблицы кодонов
Если вы хотите избежать загрузки данных через Entrez, создайте файл `data/<organism_name>_codon_usage.txt` (например, `data/Bacillus_subtilis_codon_usage.txt`) с таблицей кодонов в формате:
```
# Таблица кодонов для Bacillus subtilis
TTT 0.015
TTC 0.025
ATG 0.035
...
```
Скрипт автоматически загрузит эту таблицу вместо обращения к Entrez.

### Параметры rna_folding
- `window_size`: Размер окна для анализа мРНК (по умолчанию 40).
- `ideal_mfe`: Идеальное значение MFE (по умолчанию -4.0).
- `bad_mfe`: Пороговое значение MFE, ниже которого сворачивание считается слишком сильным (по умолчанию -12.0).

### Запуск через консоль
1. Установите email для Entrez (если не используете локальную таблицу):
   ```bash
   export ENTREZ_EMAIL="your_email@example.com"
   ```
2. Запустите скрипт для *Bacillus subtilis*:
   ```bash
   python run.py --organism "Bacillus subtilis" --organism-id "1423"
   ```
3. (Опционально) Укажите `--show-plots` для отображения графиков:
   ```bash
   python run.py --organism "Bacillus subtilis" --organism-id "1423" --show-plots
   ```

### Запуск тестов
1. Убедитесь, что зависимости установлены:
   ```bash
   pip install -r requirements.txt
   ```
2. Запустите тесты:
   ```bash
   python tests.py
   ```

## Структура проекта
- `src/codon_optimizer.py`: Основной код оптимизации.
- `tests.py`: Тесты для проверки функциональности.
- `config.json`: Конфигурация параметров оптимизации.
- `data/`: Папка для хранения FASTA файлов и таблиц кодонов.
- `optimization_results/`: Папка для результатов оптимизации (FASTA файлы, графики, сводка).

## Лицензия
MIT License. См. `LICENSE` для подробностей.